# Fix Google OAuth Redirect URI Mismatch

## The Problem

You're getting `Error 400: redirect_uri_mismatch` because the redirect URI that Cognito is sending to Google doesn't match what's configured in your Google Cloud Console.

## The Solution

Cognito uses its own callback URL format, not the localhost URLs. You need to add the Cognito callback URL to your Google OAuth client.

## Step 1: Find Your Cognito Callback URL

From your `amplify_outputs.json`, your Cognito domain is:
```
YOUR_COGNITO_DOMAIN.auth.us-east-1.amazoncognito.com
```

The callback URL format for Cognito is:
```
https://YOUR_COGNITO_DOMAIN.auth.us-east-1.amazoncognito.com/oauth2/idpresponse
```

## Step 2: Add to Google Cloud Console

1. Go to [Google Cloud Console - Credentials](https://console.cloud.google.com/apis/credentials)
2. Click on your OAuth 2.0 Client ID (the one you created for this project)
3. Under **"Authorized redirect URIs"**, add:
   ```
   https://YOUR_COGNITO_DOMAIN.auth.us-east-1.amazoncognito.com/oauth2/idpresponse
   ```
4. Click **"Save"**

## Step 3: Verify All Redirect URIs

Make sure you have these redirect URIs in Google Cloud Console:

**Authorized redirect URIs:**
- `https://YOUR_COGNITO_DOMAIN.auth.us-east-1.amazoncognito.com/oauth2/idpresponse` (Cognito callback - REQUIRED)
- `http://localhost:3000/auth/callback` (Local development - optional)
- `http://localhost:3000/` (Local development - optional)

**Authorized JavaScript origins:**
- `http://localhost:3000`
- `https://YOUR_COGNITO_DOMAIN.auth.us-east-1.amazoncognito.com` (Cognito domain)

## Step 4: Test Again

1. Go back to your app: `http://localhost:3000/auth`
2. Click "Sign in with Google"
3. It should work now!

## Important Notes

- **The Cognito callback URL is the one Google sees**, not your localhost URLs
- The format is always: `https://<cognito-domain>/oauth2/idpresponse`
- This URL is generated by Cognito and is what actually handles the OAuth callback
- Your localhost URLs in the auth config are for the final redirect after Cognito processes the OAuth

## If You Still Get Errors

1. **Clear browser cache** - Sometimes cached OAuth errors persist
2. **Check the exact error** - Look at the browser console for the exact redirect URI being sent
3. **Verify the Cognito domain** - Make sure it matches what's in `amplify_outputs.json`
4. **Wait a few minutes** - Google OAuth changes can take a minute to propagate

## Production Setup

When you deploy to production, you'll need to:
1. Get your production Cognito domain
2. Add the production callback URL to Google Cloud Console
3. Update the auth resource with production callback URLs

---

**Version**: 1.0  
**Last Updated**: November 2025

